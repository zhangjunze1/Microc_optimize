# Microcc
---
- è¯¾ç¨‹åç§°ï¼šç¼–ç¨‹è¯­è¨€åŸç†ä¸ç¼–è¯‘
- å®éªŒé¡¹ç›®ï¼šæœŸæœ«å¤§ä½œä¸š
- ä¸“ä¸šç­çº§ï¼šè®¡ç®—æœº1801
- å­¦ç”Ÿå­¦å·ï¼š31801087ï¼Œ31801082
- å­¦ç”Ÿå§“åï¼šå¼ é’§æ³½ï¼Œè«æ˜è¾¾
- å®éªŒæŒ‡å¯¼æ•™å¸ˆ: éƒ­é¸£
- https://github.com/zhangjunze1/Microc_optimize/tree/master
---

## ç®€ä»‹
è¿™æ˜¯ä¸€ä¸ªç¼–è¯‘åŸç†å¤§ä½œä¸šï¼Œä¸»è¦åŸºäºmicroCå®Œæˆçš„ã€‚

æœ¬æ¬¡å¤§ä½œä¸šï¼Œæˆ‘ä»¬åœ¨è§£é‡Šå™¨ä¸­åšäº†å¤§é‡çš„å°è¯•ï¼Œæƒ³å¯¹breakå’Œcontinueè¿˜æœ‰returnåšå¤„ç†ï¼Œä¿®æ”¹äº†ç¯å¢ƒå˜é‡ä»¥è¾¾åˆ°ç›®çš„ã€‚æ‰€ä»¥åœ¨ç¼–è¯‘å™¨ä¸­å°±æ²¡æœ‰å®ç°breakã€continueå’Œreturnçš„åŠŸèƒ½ã€‚ç¼–è¯‘å™¨èƒ½å¤Ÿå¾ˆå¥½çš„å‚ç…§ä¼˜ç§€ä½œä¸šå»å­¦ä¹ ï¼Œè€Œè§£é‡Šå™¨éœ€è¦æŒ‰ç…§è‡ªå·±çš„æ€è·¯è®¾è®¡è¯æ³•åˆ†æå™¨ï¼Œè¯­æ³•åˆ†æå™¨ï¼Œä»¥åŠå˜é‡å®šä¹‰ï¼Œæ­å»ºæ¡†æ¶ç­‰ç­‰ã€‚


## ç»“æ„
- å‰ç«¯ï¼šç”±`F#`è¯­è¨€ç¼–å†™è€Œæˆ  
  - `Clex.fsl`ç”Ÿæˆçš„`Clex.fs`è¯æ³•åˆ†æå™¨ã€‚
  - `CPar.fsy`ç”Ÿæˆçš„`Cpar.fs`è¯­æ³•åˆ†æå™¨ã€‚
  - `Absyn.fs` å®šä¹‰äº†æŠ½è±¡è¯­æ³•æ ‘
  - `Machine.fs`å®šä¹‰äº†ä¸­é—´è¡¨ç¤ºçš„ç”ŸæˆæŒ‡ä»¤é›†
  - `interp.fs`è§£é‡Šå™¨
  - `Contcomp.fs`ç¼–è¯‘å™¨

- ç¼–è¯‘å™¨åç«¯ï¼šç”±`Java`è¯­è¨€ç¼–å†™è€Œæˆ
  - `Machine.java`ç”Ÿæˆ`Machine.class`è™šæ‹Ÿæœºä¸`Machinetrace.class`å †æ ˆè¿½è¸ª

- æµ‹è¯•é›†ï¼šæµ‹è¯•ç¨‹åºæ”¾åœ¨`test`æ–‡ä»¶å¤¹å†…

- åº“ï¼š`.net`æ”¯æŒ
  - `FsLexYacc.Runtime.dll`
## ç”¨æ³•
- ` dotnet restore  interpc.fsproj `
- ` dotnet clean  interpc.fsproj  `
- ` dotnet build -v n interpc.fsproj  `
æ„å»ºè§£é‡Šå™¨ 

- ` dotnet run -p interpc.fsproj test/for.c `
æµ‹è¯•æ ·ä¾‹forå¾ªç¯

å…¶ä½™è¯¦è§ä¸Šæ‰‹æµç¨‹


- ` dotnet restore  microcc.fsproj  `
- ` dotnet clean  microcc.fsproj  `
- ` dotnet build  microcc.fsproj  `
æ„å»ºç¼–è¯‘å™¨

- ` dotnet run -p microc.fsproj test/for.c  `
æ­¤å¤„test/for.cè¿™ä¸ªéƒ¨åˆ†æ˜¯ä½ è¦è¿è¡Œçš„.cæ–‡ä»¶ å¯¹åº”ç”Ÿæˆ.outæ–‡ä»¶ï¼ˆæœºå™¨ä»£ç ï¼‰

- ` javac Machine.java  `
- ` java Machine test/for.out  `
machine.java ç”¨javaç¯å¢ƒ 
ç¼–è¯‘ç”Ÿæˆæ–°çš„classæ–‡ä»¶--è™šæ‹ŸæœºåŠŸèƒ½


## åŠŸèƒ½å®ç°
- å˜é‡å®šä¹‰
  - ç®€ä»‹ï¼šåŸæœ¬çš„microCåªæœ‰å˜é‡å£°æ˜ï¼Œæˆ‘ä»¬æ”¹è¿›äº†å®ƒä½¿å®ƒå…·æœ‰å˜é‡å®šä¹‰ï¼Œä¸”åœ¨localç¯å¢ƒéƒ½å…·æœ‰å˜é‡å®šä¹‰åŒæ—¶èµ‹å€¼çš„åŠŸèƒ½ã€‚
  
  - int 
    ```C
    // int.c
    int a;
    int b;
    void main() {
      int n=1;
      a = 1;
      b = 2+3;
      print("%d",n);
      print("%d",a);
      print("%d",b);
    }
    
    ```
    
	 - ç­”æ¡ˆ  
   ![](img/int.c.png)
  
  - è¯­æ³•æ ‘ï¼ˆè§£é‡Šå™¨ï¼‰ 
  ![](img/int.cè¯­æ³•æ ‘.png )
  - å †æ ˆå›¾ï¼ˆç¼–è¯‘å™¨ï¼‰
  ![](img/int.cå †æ ˆå›¾.png )   

---

- char ç±»å‹
  - ç®€ä»‹ï¼šå¯å®šä¹‰èµ‹å€¼
  - ä¾‹å­ï¼š

    ```C
    char a;
    void main() {
    char b;
    char c='c';
    a='a';
    b='b';
    print("%d",a);
    print("%d",b);
    print("%d",c);
    }
    ```
  - ç­”æ¡ˆ
     ![](img/char.png)
  - è¯­æ³•æ ‘ï¼ˆè§£é‡Šå™¨ï¼‰ï¼š  
    ![](img/char1.png)
  - è¿è¡Œæ ˆè¿½è¸ªï¼š  
    ![](img/char2.png)

---
- è‡ªå¢æ“ä½œ
    - ç®€ä»‹:åŒ…å«i++ ++i -- -=ç­‰ç­‰æ“ä½œ
    - ä¾‹å­ï¼š
        ```C
        void main() {
        int i=1;
        i++;
        print("%d",i);
        i--;
        print("%d",i);
        i+=2;
        print("%d",i);
        i-=2;
        print("%d",i);
        i*=2;
        print("%d",i);
        i/=2;
        print("%d",i);
        i%=2;
        print("%d",i);
        }
        ```
	- è¯­æ³•æ ‘
        ![](img/simpleOpt1.png)
    - è¿è¡Œæ ˆè¿½è¸ªï¼š  
        ![](img/simpleOpt2.png)
        ![](img/simpleOpt3.png)
---
- FORå¾ªç¯
    - ç®€ä»‹ï¼šå¢åŠ äº†forå¾ªç¯ 
    - ä¾‹å­ï¼š
```C
    void main() {
    int n=5;
    int i;
    for (i = 0; i < n; i=i+1)
    {
    print("%d",i);
    }
    }
    
```
- è¯­æ³•æ ‘
  ![](img/for1.png)
    - è¿è¡Œæ ˆè¿½è¸ªï¼š  

 ![](img/char2.png) 

---
- FORå¾ªç¯ åŠ ä¸Šbreak
    - ç®€ä»‹ï¼šå¢åŠ äº†forå¾ªç¯ä¸break 
    - ä¾‹å­ï¼š
```C
      void main() {
      int n=5;
      int i;
      for (i = 0; i < n; i++)
      {
      print("%d",i);
      if (i==3){break;}
      print("%d",i);
      }

}
```

â€‹        
â€‹    - è¯­æ³•æ ‘
â€‹        ![](img/for-switch.png)
â€‹    - è¿è¡Œæ ˆè¿½è¸ªï¼š  


---
- ä¸‰ç›®è¿ç®—ç¬¦
    - ç®€ä»‹ï¼šä¸‰ç›®è¿ç®—ç¬¦ n?a:b
    - ç”¨ä¾‹ï¼š
```C
void main() {
  int n=5;
  if(n? 1:0){
    print("%d",n);
  }
}
```
- è¯­æ³•æ ‘ï¼š
  ![](img/ques1.png)
- è¿è¡Œæ ˆè¿½è¸ªï¼š  

  ![](img/ques2.png) 

---
- do - while
    - ç®€ä»‹ï¼šåœ¨åˆ¤æ–­å‰å…ˆè¿è¡Œbodyä¸­çš„æ“ä½œã€‚ èƒ½å¯¹break continueä½œå‡ºååº”
    - ä¾‹å­ï¼š
```C
void main() {
  int i=5;
  do{
      print("%d",i);
      i=i+1;
  } while (i<4);
}
```
  - å †æ ˆå›¾ï¼š
![](img/Dowhile.png)
  - è¿è¡Œæ ˆè¿½è¸ªï¼š
![](img/Dowhile2.png)


---
- ç±»ä¼¼Cçš„switch-case
    - ä¾‹å­ï¼š
        ```C
        void main() {
        	int n=5;
        	switch(n){
        		case 1: n++;
        		case 2: n--;
        		case 5: n=n+3;
        		case 8: n=1;
        	}
        	print n;
      }
- è¯­æ³•æ ‘ï¼š
  ![](img/switch.png)

  


---

- continueåŠŸèƒ½
    - åœ¨for while dowhileä¸­ï¼Œéƒ½åŠ å…¥break å’ŒcontinueåŠŸèƒ½
    - ç»´æŠ¤Labelè¡¨æ¥å®ç°
        ```C
        void main() {
      int n=5;
      int i;
      for (i = 0; i < n; i=i+1)
      {
      print("%d",i);
      continue;
      print("%d",i);
      }
        }


- è¯­æ³•æ ‘
 ![](img/continue.png)
- è¿è¡Œæ ˆè¿½è¸ª
 ![](img/continue2.png)

---
- breakåŠŸèƒ½
```C
void main() {
  int n=5;
  int i;
  for (i = 0; i < n; i++)
  {
    print("%d",i);
    if (i==3){break;}
    print("%d",i);
  }
}
```
- è¯­æ³•æ ‘
![](img/break2.png)
![](img/break3.png)
![](img/break4.png)

---
- returnåŠŸèƒ½
    - åœ¨å‡½æ•°å®šä¹‰ä¸­ï¼Œå¯¹returnçš„è¿”å›çš„å®ç°
```

â€‹```C
        void main(int n) {
      int q;
      q = fun(n);
      print("%d",q);
        }

	void fun(int i){
	  i=i+7;
	  return i;
	}

```
  - è¯­æ³•æ ‘
 ![](img/return1.png)

 



## å¿ƒå¾—ä½“ä¼š
- å¼ é’§æ³½ï¼š  
    è¿™å­¦æœŸå¤§ä½œä¸šæ¯”è¾ƒå¤šï¼Œå››ä¸ªè¯¾ç¨‹æ˜¯å››ä¸ªè®¡ç®—æœºçš„æ–¹å‘ï¼Œæ¯ä¸ªè¯¾ç¨‹æˆ‘éƒ½æ˜¯ç»„é•¿ï¼Œåšçš„ä¸œè¥¿æœ‰ç‚¹å¤šï¼Œæ¯å¤©éƒ½åœ¨å„ä¸ªé¡¹ç›®ä¹‹é—´å¾˜å¾Šå­¦ä¹ ã€‚F#æ˜¯ä¸€ä¸ªå®Œå…¨æ²¡æ¥è§¦è¿‡çš„å…¨æ–°ç±»å‹çš„è¯­è¨€ï¼Œèµ„æ–™å®åœ¨å¤ªå°‘äº†ï¼Œä¸€åˆ‡éƒ½å¾—è‡ªå·±æ…¢æ…¢æ‘¸ç´¢ã€‚å®åœ¨æ˜¯ç—›è‹¦ã€‚https://docs.microsoft.com/zh-cn/dotnet/fsharp/ ä»ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨çš„è§’åº¦å­¦ä¹ ä»‹äºæœºå™¨ä¸ç¨‹åºä¹‹é—´çš„æ¡¥æ¢ï¼Œè®©æˆ‘æ›´æ·±ä¸€æ­¥äº†è§£ä¸€äº›è¯­è¨€æ¨¡å‹ï¼Œæœºå™¨æ¨¡å‹ï¼Œè¯­ä¹‰è¯­æ³•ç»“æ„ç­‰ã€‚åŠ æ·±å¯¹äºè®¡ç®—æœ¬è´¨çš„ç†è§£ä¸è¿ç”¨ã€‚å…¶å®è€å¸ˆä¸Šè¯¾çš„å†…å®¹ï¼Œå…¶å®æ¯èŠ‚è¯¾éƒ½æ˜¯æ„Ÿè§‰å­¦å¾—ä¸€çŸ¥åŠè§£ï¼Œä¸œè¥¿å®åœ¨å¤ªå¤šï¼Œä¹Ÿæ¯”è¾ƒéš¾ä»¥æ¶ˆåŒ–ï¼Œéš”äº†å‡ å¤©å°±å…¨å¿˜å¾—å·®ä¸å¤šäº†ã€‚ä¸è¿‡é€šè¿‡è¿™æ¬¡å¤§ä½œä¸šä¹‹åï¼Œæ”¶è·é¢‡ä¸°ã€‚æ›´æ˜¯æ·±åˆ»ç†è§£äº†å‡½æ•°ï¼Œbreakï¼Œcontinueçš„è¿è¡Œæœºåˆ¶ï¼Œä»¥åŠåŠ æ·±å¯¹æ•´ä¸ªè®¡ç®—æœºä¸Šç³»ç»Ÿçš„æ·±åˆ»ç†è§£ã€‚
    
    - äº†è§£äº†å‡½æ•°å¼ç¼–ç¨‹çš„è¯­è¨€ç‰¹ç‚¹ä¸ç‰¹æ€§ï¼Œæ‹“å®½è§†é‡ã€‚
    - åˆ©ç”¨F#ä¸javaå®Œå–„äº†ä¸€ä¸ªç¼–ç¨‹è¯­è¨€çš„ä»å‰ç«¯åˆ°åç«¯çš„å®Œæ•´çš„æ­å»º
    - æ¸…æ¥šäº†ä¸€äº›å…³äºCè¯­è¨€çš„è®¾è®¡æ–¹æ³•ä¸å±€é™æ€§ã€‚
    - ç†è§£äº†æ ˆå¼è™šæ‹Ÿæœºçš„å·¥ä½œåŸç†ä¸ä¸€äº›è®¾è®¡æ–¹æ³•
    - äº†è§£äº†ç¼–è¯‘å’Œè§£é‡Šçš„è¿‡ç¨‹ï¼Œæ›´æ·±åˆ»çš„å­¦ä¹ äº†è®¡ç®—æœºçš„æœ¬è´¨
    
    ç”±äºæ²¡æ¯å¤§ä½œä¸šæ—¶é—´éƒ½å¤ªç´§äº†ï¼Œå¦‚æœæ—¶é—´å†å¤šä¸€ç‚¹çš„è¯ï¼Œè¿˜å¯ä»¥å¾€å‘ç¼–è¯‘å™¨ä¸­è¡¥å……ä½¿å…¶å®Œå–„ã€‚æ€»è€Œè¨€ä¹‹ï¼Œè¿™èŠ‚ç¼–è¯‘åŸç†è¯¾ï¼Œæ”¶è·é¢‡ä¸°ï¼ŒF#å¥½ç”¨å€¼å¾—å­¦ä¹ ã€‚ç¼–è¯‘åŸç†çš„ä¸–ç•Œè¿˜æ˜¯ç›¸å½“æœ‰è¶£çš„ã€‚  

- è«æ˜è¾¾ï¼š  
    æœ¬å­¦æœŸçš„ç¼–è¯‘åŸç†å­¦ä¹ ï¼Œè‡ªå·±è¿˜æ˜¯èŠ±äº†æŒºå¤šæ—¶é—´çš„ã€‚å‰æœŸå„å‘¨çš„ä½œä¸šä»¥åŠåæœŸçš„å¤§ä½œä¸šï¼Œéƒ½éœ€è¦æŠ•å…¥ä¸€å®šçš„ç²¾åŠ›å»äº†è§£ã€å­¦ä¹ ã€‚é€šè¿‡è¿™æ¬¡ç¼–è¯‘åŸç†è¯¾ç¨‹çš„å­¦ä¹ ï¼Œæˆ‘äº†è§£å¹¶æŒæ¡äº†ç¼–è¯‘åŸç†å¤§è‡´çš„æ¡†æ¶å’Œé€»è¾‘ã€‚è®©æˆ‘æ›´æ·±ä¸€æ­¥äº†è§£ä¸€äº›è¯­è¨€æ¨¡å‹ï¼Œæœºå™¨æ¨¡å‹ï¼Œè¯­ä¹‰è¯­æ³•ç»“æ„ç­‰ã€‚åŒæ—¶ï¼Œæ„Ÿè°¢éƒ­é¸£è€å¸ˆçš„æ•™å¯¼ã€‚
    æ€»ç»“ä¸€ä¸‹
    
    - å¤§ä½œä¸šå®Œæˆä¸­ï¼Œå¯¹æŒ‡ä»¤ä¸æ ˆç»“æ„æœ‰äº†æ›´æ·±çš„äº†è§£
    - éšç€å¯¹fsharpçš„ä½¿ç”¨è¶ŠåŠ é¢‘ç¹ï¼Œä¹ŸåŠ æ·±äº†å¯¹å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€çš„å°è±¡
    - è¿‡ç¨‹çš„ç§¯ç´¯ä¸­ï¼Œé€æ¸äº†è§£ä¸€äº›ç¼–è¯‘çš„ç†å¿µï¼Œè®¡ç®—çš„æ€ç»´ã€‚
    - åœ¨å¤§ä½œä¸šæœ‰äº›åŠŸèƒ½çš„å®Œæˆä¸Šï¼Œè¿˜å¯ä»¥å†ä¼˜åŒ–ç²¾ç®€ã€‚

## æŠ€æœ¯è¯„ä»·

| åŠŸèƒ½ | å¯¹åº”æ–‡ä»¶ | ä¼˜  | è‰¯  | ä¸­  |
| ---- | -------- | --- | --- | --- |
|å˜é‡å£°æ˜å®šä¹‰|int.c \ char.c          |âˆš|||
|è‡ªå¢ã€è‡ªå‡ è‡ªè¿ç®—+=ç­‰ç­‰| simpleOpt.c    |âˆš|||
|forå¾ªç¯|for.c|âˆš|||
|ä¸‰ç›®è¿ç®—ç¬¦|QuestionAndColon.c|âˆš|||
|do-while|Dowhile.c|âˆš|||
|while|while.c|âˆš|||
|break|break.c|âˆš|||
|continue|continue.c|âˆš|||
|switch-case|switch.c||âˆš||
|char ç±»å‹|char.c|âˆš|||
|return |return.c|âˆš|||
## å°ç»„åˆ†å·¥

- å¼ é’§æ³½
  - å­¦å·ï¼š31801087
  - ç­çº§ï¼šè®¡ç®—æœº1801
    - å·¥ä½œå†…å®¹
      - æ–‡æ¡£ç¼–å†™
      - æµ‹è¯•ç¨‹åº
      - è¯­æ³•åˆ†æ
      - è¯æ³•åˆ†æ
      - æ ˆã€å †è®¾è®¡
      - breakã€continueã€return
- è«æ˜è¾¾
  - å­¦å·ï¼š31801082
  - ç­çº§ï¼šè®¡ç®—æœº1801
    - å·¥ä½œå†…å®¹
      - æ–‡æ¡£ç¼–å†™
      - æµ‹è¯•ç¨‹åº
      - è¯­æ³•åˆ†æ
      - è¯æ³•åˆ†æ
      - è‡ªè¿ç®—
  
- æƒé‡åˆ†é…è¡¨ï¼š  

| å¼ é’§æ³½ | è«æ˜è¾¾ |
| ------ | ------ |
| 1.00  | 0.90   |


# æœ¬ç»„æˆå‘˜æ’°å†™çš„ä¸Šæ‰‹æµç¨‹ğŸ‘‰

## ä¸Šæ‰‹ç¼–è¯‘åŸç†å¤§ä½œä¸š

### è§£é‡Šå™¨éƒ¨åˆ†--interpreter

+ Absyn.fs    æŠ½è±¡è¯­æ³•ç±» ä¸å®é™…å®è·µå¹¶æœ‰å…³è” 
+ CLex.fsl    è¯æ³•åˆ†æå™¨--
	+ ä¾‹å¦‚å®šä¹‰ for ç­‰å…³é”®å­—
+ CPar.fsy   è¯­æ³•åˆ†æå™¨--
	+ ä¾‹å¦‚ å®šä¹‰do while è¿›è¡Œä½¿ç”¨çš„æ—¶å€™ ï¼ˆwhileå·²ç»ä½œä¸ºå…³é”®å­—ä½¿ç”¨è¿‡ æ‰€ä»¥ä½ éœ€è¦åˆ©ç”¨è¯­æ³•å®šä¹‰å®ç°do whileï¼‰
+ Parse.fs  æœ€å¥½ä¸è¦åŠ¨ è¯­æ³•è§£æå™¨-- è¯æ³•åˆ†æç¨‹åº--è¯­æ³•åˆ†æç¨‹åºï¼ˆæ²¡å¿…è¦åŠ¨ï¼‰
+ Interp.fs éœ€è¦æ›´æ–°
+ interpc.fsproj æ­¤æ–‡æ¡£æ˜¯é¡¹ç›®è°ƒç”¨çš„fsæ–‡æ¡£ç­‰ç­‰ 


### è§£é‡Šå™¨å…·ä½“æµç¨‹
+ å†™CLex.fsl è¯æ³•åˆ†æå™¨
+ å†™CPar.fsy è¯­æ³•åˆ†æå™¨

```
# ç¼–è¯‘è§£é‡Šå™¨ interpc.exe å‘½ä»¤è¡Œç¨‹åº 
dotnet restore  interpc.fsproj   # å¯é€‰
dotnet clean  interpc.fsproj     # å¯é€‰
dotnet build -v n interpc.fsproj # æ„å»º./bin/Debug/net5.0/interpc.exe ï¼Œ-v næŸ¥çœ‹è¯¦ç»†ç”Ÿæˆè¿‡ç¨‹

# æ‰§è¡Œè§£é‡Šå™¨
./bin/Debug/net5.0/interpc.exe ex1.c 8
dotnet run -p interpc.fsproj ex1.c 8
dotnet run -p interpc.fsproj -g ex1.c 8  //æ˜¾ç¤ºtoken AST ç­‰è°ƒè¯•ä¿¡æ¯

# one-liner 
# è‡ªè¡Œä¿®æ”¹ interpc.fsproj  ä¾æ¬¡è§£é‡Šå¤šä¸ªæºæ–‡ä»¶
dotnet build -t:ccrun interpc.fsproj 
```
+ dotnetå‘½ä»¤è¡Œfsiä¸­è¿è¡Œè§£é‡Šå™¨
```
# å‘½ä»¤è¡Œè¿è¡Œç¨‹åº
dotnet fsi 

#r "nuget: FsLexYacc";;  //æ·»åŠ åŒ…å¼•ç”¨ å¿…é¡»è¦çš„
#load "Absyn.fs" "Debug.fs" "CPar.fs" "CLex.fs" "Parse.fs" "Interp.fs" "ParseAndRun.fs" ;; // éœ€è¦çš„åŒ…çš„åå­—

open ParseAndRun;;    //å¯¼å…¥æ¨¡å— ParseAndRun
fromFile "example\ex1.c";;    //æ˜¾ç¤º ex1.cçš„è¯­æ³•æ ‘ // å†™å¥½çš„.cæ–‡ä»¶
run (fromFile "example\ex1.c") [17];; //è§£é‡Šæ‰§è¡Œ ex1.c
run (fromFile "example\ex11.c") [8];; //è§£é‡Šæ‰§è¡Œ ex11.c

Debug.debug <-  true  //æ‰“å¼€è°ƒè¯•

run (fromFile "example\ex1.c") [8];; //è§£é‡Šæ‰§è¡Œ ex1.c
run (fromFile "example\ex11.c") [8];; //è§£é‡Šæ‰§è¡Œ ex11.
#q;;
```
### å®Œæ•´è¿è¡Œæ­¥éª¤
```
ç¬¬ä¸€éƒ¨åˆ†æ˜¯è¿è¡ŒæŠŠ.cæ–‡ä»¶åœ¨è§£é‡Šå™¨çš„ç¯å¢ƒä¸‹è·‘ä¸€éå¾—åˆ°ç»“æœ---ä¸é€šè¿‡dotnet fsi
=======================================================================
dotnet restore  interpc.fsproj   
dotnet clean  interpc.fsproj     
dotnet build -v n interpc.fsproj --è§£é‡Šå™¨é‡æ–°æ„å»º// è¿™ä¸ªéƒ¨åˆ†å°±æ˜¯æŠŠä½ çš„ è¯æ³•åˆ†æå™¨å’Œè¯æ³•åˆ†æå™¨æ–°å†™çš„éƒ¨åˆ†è¦†ç›–æ‰åŸæ¥çš„éƒ¨åˆ†

dotnet run -p interpc.fsproj example/ex1.c 8   // æ­¤å¤„ example/ex1.c è¿™ä¸ªéƒ¨åˆ†æ˜¯ä½ è¦è¿è¡Œçš„.cæ–‡ä»¶  // 8æŒ‡çš„æ˜¯è¿™ä¸ªæ–‡ä»¶éœ€è¦è¯»å…¥çš„æ•°
// å¯ä»¥ä¸ç”¨çš„ dotnet build -t:ccrun interpc.fsproj  //è‡ªè¡Œä¿®æ”¹ interpc.fsproj  ä¾æ¬¡è§£é‡Šå¤šä¸ªæºæ–‡ä»¶

=======================================================================
ç¬¬äºŒéƒ¨åˆ†æ˜¯é€šè¿‡å‘½ä»¤è¡Œè¿è¡Œ å¯ä»¥æŸ¥çœ‹è¯­æ³•æ ‘ å¯ä»¥æœºå‹è§£é‡Šæ‰§è¡Œ å¯ä»¥è¿›è¡Œdebugè°ƒè¯•  // æ‹¿example/ex1.c ä¸¾ä¾‹ 
=======================================================================
dotnet restore  interpc.fsproj   
dotnet clean  interpc.fsproj     
dotnet build -v n interpc.fsproj --è§£é‡Šå™¨é‡æ–°æ„å»º// è¿™ä¸ªéƒ¨åˆ†å°±æ˜¯æŠŠä½ çš„ è¯æ³•åˆ†æå™¨å’Œè¯æ³•åˆ†æå™¨æ–°å†™çš„éƒ¨åˆ†è¦†ç›–æ‰åŸæ¥çš„éƒ¨åˆ†
// è¿›å…¥ploofs/microc æ–‡ä»¶å¤¹ä¸‹
dotnet fsi  // è¿›å…¥å‘½ä»¤è¡Œè¿è¡Œç¨‹åº

#r "nuget: FsLexYacc";;  //æ·»åŠ åŒ…å¼•ç”¨ ----#å·ä¸è¦å»æ‰---- è°ƒç”¨ç¼–è¯‘å™¨çš„åŸºæœ¬çš„åŒ…
#load "Absyn.fs" "Debug.fs" "CPar.fs" "CLex.fs" "Parse.fs" "Interp.fs" "ParseAndRun.fs" ;; // ---è°ƒç”¨ä½ å†™çš„è¯æ³•åˆ†æå™¨ è¯­æ³•åˆ†æå™¨ç­‰ç­‰.fsæ–‡ä»¶

open ParseAndRun;;    // å¯¼å…¥æ¨¡å— ParseAndRun
fromFile "Mytest.c";;    // æ˜¾ç¤º ex1.cçš„è¯­æ³•æ ‘
run (fromFile "Mytest.c") [17];; //è§£é‡Šæ‰§è¡Œ ex1.c

Debug.debug <-  true  //æ‰“å¼€è°ƒè¯• å¦‚æœä¸Šä¸€æ­¥è¿è¡Œé”™è¯¯å¯ä»¥é€šè¿‡debugçš„æ¨¡å¼è¿›è¡Œåˆ¤æ–­
run (fromFile "example\ex1.c") [8];; //è§£é‡Šæ‰§è¡Œ ex1.c

#q;; // é€€å‡º
```





### ç¼–è¯‘å™¨éƒ¨åˆ†--compiler 

**PS: è§£é‡Šå™¨åšå¥½çš„åŠŸèƒ½ ç¼–è¯‘å™¨ä¸€æ ·èƒ½ç”¨  ï¼ˆæŠŠ.cæ–‡ä»¶å˜æˆ.out æœºå™¨ä»£ç çš„éƒ¨åˆ†ï¼‰**
**PS: ç¼–è¯‘å™¨çš„éƒ¨åˆ†çš„machine.javaå°±æ˜¯ç”¨äºåç¼–è¯‘ æŠŠ.outæ–‡ä»¶ åç¼–è¯‘ä¹‹åè¿è¡Œå¾—å‡ºç»“æœ**

å½“ç„¶å¦‚æœæ·»åŠ äº†å…³é”®å­—å°±è¦ä¿®æ”¹ machine.javaçš„éƒ¨åˆ†å»è°ƒæ•´ å¯¹åº”çš„å…³é”®å­—å’Œç§åˆ«ç ---ï¼ˆåº”è¯¥æ˜¯è¿™ä¸ªæœ¯è¯­ï¼‰

+ Machine.fs ï¼ˆåŸºæœ¬ä¸ç”¨æ”¹ï¼‰--æ±‡ç¼–æŒ‡ä»¤çš„æ·»åŠ 
+ é€‰æ‹©ä½¿ç”¨çš„è¯­è¨€è¿›è¡Œåç¼–è¯‘
	1. Machine.java                    VM å®ç° java
	2. machine.c                          VM å®ç° c 
	3. machine.cs                  VM å®ç° c#
+ machine.csproj                           VM é¡¹ç›®æ–‡ä»¶
+ microcc.fsproj ç¼–è¯‘å™¨é¡¹ç›®æ–‡ä»¶
+ .....çœç•¥

###  ç¼–è¯‘å™¨å®Œæ•´è¿è¡Œæ­¥éª¤ 

#### ç¬¬ä¸€éƒ¨åˆ†ï¼šå¼€å‘å 
+ å¼€å‘çš„æ—¶å€™ä¸»è¦ç”¨ç¬¬äºŒéƒ¨åˆ†
+ å¼€å‘ä»¥åé€šè¿‡ç¼–è¯‘å™¨è¿è¡Œ.cæ–‡ä»¶çš„æ—¶å€™éœ€è¦ç”¨ç¬¬ä¸€éƒ¨åˆ†
```
ç¬¬ä¸€éƒ¨åˆ†æ˜¯è¿è¡ŒæŠŠ.cæ–‡ä»¶åœ¨è§£é‡Šå™¨çš„ç¯å¢ƒä¸‹è·‘ä¸€éå¾—åˆ°ç»“æœ---ä¸é€šè¿‡dotnet fsi
=======================================================================
dotnet restore  microcc.fsproj    
dotnet clean  microcc.fsproj   
dotnet build  microcc.fsproj    --ç¼–è¯‘å™¨é‡æ–°æ„å»º// è¿™ä¸ªéƒ¨åˆ†å°±æ˜¯æŠŠä½ çš„ è¯æ³•åˆ†æå™¨å’Œè¯æ³•åˆ†æå™¨æ–°å†™çš„éƒ¨åˆ†è¦†ç›–æ‰åŸæ¥çš„éƒ¨åˆ† ç„¶åå¯¼å…¥.fsæ–‡ä»¶
=======================================================================
dotnet run -p microcc.fsproj mytest.c  // æ­¤å¤„ mytest.c è¿™ä¸ªéƒ¨åˆ†æ˜¯ä½ è¦è¿è¡Œçš„.cæ–‡ä»¶  // 8æŒ‡çš„æ˜¯è¿™ä¸ªæ–‡ä»¶éœ€è¦è¯»å…¥çš„æ•°
=======================================================================
// dotnet built -t:ccrun microc.fsproj     # ç¼–è¯‘å¹¶è¿è¡Œ example ç›®å½•ä¸‹å¤šä¸ªæ–‡ä»¶ å¯ä»¥ä¸ç”¨
// dotnet built -t:cclean microc.fsproj    # æ¸…é™¤ç”Ÿæˆçš„æ–‡ä»¶
```

#### ç¬¬äºŒã€ä¸‰éƒ¨åˆ†ï¼šå¼€å‘æ—¶
```
ç¬¬äºŒéƒ¨åˆ†æ˜¯é€šè¿‡å‘½ä»¤è¡Œè¿è¡Œ å¯ä»¥æœºå‹ç¼–è¯‘æ‰§è¡Œ ç”Ÿæˆ.outæ–‡ä»¶  // æ‹¿mytest.c ä¸¾ä¾‹ 
=======================================================================
dotnet restore  microcc.fsproj    
dotnet clean  microcc.fsproj   
dotnet build  microcc.fsproj  --ç¼–è¯‘å™¨é‡æ–°æ„å»º// è¿™ä¸ªéƒ¨åˆ†å°±æ˜¯æŠŠä½ çš„ è¯æ³•åˆ†æå™¨å’Œè¯æ³•åˆ†æå™¨æ–°å†™çš„éƒ¨åˆ†è¦†ç›–æ‰åŸæ¥çš„éƒ¨åˆ† ç„¶åå¯¼å…¥.fsæ–‡ä»¶
=======================================================================
// è¿›å…¥ploofs/microc æ–‡ä»¶å¤¹ä¸‹
dotnet fsi  // è¿›å…¥å‘½ä»¤è¡Œè¿è¡Œç¨‹åº
=======================================================================
#r "nuget: FsLexYacc";;  #å·ä¸è¦å»æ‰---- è°ƒç”¨ç¼–è¯‘å™¨çš„åŸºæœ¬çš„åŒ…
#load "Absyn.fs"  "CPar.fs" "CLex.fs" "Debug.fs" "Parse.fs" "Machine.fs" "Backend.fs" "Contcomp.fs" "ParseAndContcomp.fs";;  // ---è°ƒç”¨ä½ å†™çš„è¯æ³•åˆ†æå™¨ è¯­æ³•åˆ†æå™¨ç­‰ç­‰.fsæ–‡ä»¶
=======================================================================
// è¿è¡Œç¼–è¯‘å™¨
open ParseAndContcomp;;   // å¯¼å…¥æ¨¡å— ParseAndRun
contCompileToFile (fromFile "mytest.c") "mytest.out";;  // ç”Ÿæˆäº†å¯¹åº”çš„mytest.outæ–‡ä»¶
```



```
ç¬¬ä¸‰éƒ¨åˆ†è¡”æ¥ç¬¬äºŒéƒ¨åˆ† // è™šæ‹Ÿæœºæ„å»ºä¸è¿è¡Œ
=======================================================================
// å›åˆ°æ–‡ä»¶ç›®å½• ctrl+D é€€å‡ºdotnet  æ‹¿mytest.outä¸¾ä¾‹ 
=======================================================================
// è¿è¡Œè™šæ‹Ÿæœº åœ¨dotnetç¯å¢ƒä¸‹
dotnet clean  machine.csproj
dotnet run -p machine.csproj mytest.out 3 # è¿è¡Œè™šæ‹Ÿæœºï¼Œæ‰§è¡Œ mytest.out
./bin/Debug/net5.0/machine.exe -t ex9.out 0 
=======================================================================
// ç”¨machine.c ç”¨javaç¯å¢ƒ ï¼ˆæˆ‘æ˜¯ç”¨javaç¯å¢ƒï¼‰
javac Machine.java // ç¼–è¯‘ç”Ÿæˆæ–°çš„classæ–‡ä»¶
java Machine Mytest.out 3

---å³å¯éªŒè¯æ˜¯å¦æˆåŠŸ

```

